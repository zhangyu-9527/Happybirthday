<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ‚ ç”Ÿæ—¥å¿«ä¹ï¼</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "åæ–‡è¡Œæ¥·", "STXingkai", "KaiTi", "Microsoft YaHei", cursive;
      overflow: hidden;
      position: relative;
      color: white;
      transition: background 1s ease;
    }

    body.dark-mode {
      background: #000 !important;
    }

    /* ä¸»å†…å®¹å®¹å™¨ */
    #main-content {
      text-align: center;
      z-index: 10;
      transition: opacity 0.5s;
    }

    /* å€’è®¡æ—¶æ•°å­— */
    #countdown {
      font-size: 7rem;
      font-weight: bold;
      text-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
      color: #fff;
      filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7));
    }

    /* è›‹ç³•å®¹å™¨ */
    #cake-container {
      width: 240px;
      height: auto;
      margin: 0 auto;
    }

    .cake-part {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.7s ease, transform 0.7s ease;
    }

    .visible {
      opacity: 1 !important;
      transform: translateY(0) !important;
    }

    /* ç¥ç¦è¯­ï¼ˆåˆå§‹éšè—ï¼‰ */
    #wish {
      font-size: 2.4rem;
      font-weight: bold;
      margin-top: 24px; /* å…³é”®ï¼šä¸è›‹ç³•ä¿æŒèˆ’é€‚é—´è· */
      text-shadow: 0 0 12px rgba(255, 255, 255, 0.9);
      opacity: 0;
      transition: opacity 1s ease 0.3s;
    }

    body.dark-mode #wish {
      opacity: 1;
    }

    /* è¯—å¥åŒºåŸŸ */
    #poem-container {
      position: fixed;
      bottom: 24%;
      left: 50%;
      transform: translateX(-50%) translateY(30px);
      width: 90%;
      max-width: 500px;
      text-align: center;
      opacity: 0;
      z-index: 15;
      transition: opacity 1.2s ease 0.6s, transform 1.2s ease 0.6s;
    }

    body.dark-mode #poem-container {
      opacity: 1 !important;
      transform: translateX(-50%) translateY(0) !important;
    }

    .poem-line {
      font-size: 1.6rem;
      margin: 10px 0;
      color: #fff;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
      opacity: 0;
      animation: poemFloat 8s infinite ease-in-out;
    }

    @keyframes poemFloat {
      0% { opacity: 0; transform: scale(0.95); }
      10% { opacity: 1; }
      90% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.05); }
    }

    .poem-line:nth-child(1) { animation-delay: 0s; }
    .poem-line:nth-child(2) { animation-delay: 2s; }
    .poem-line:nth-child(3) { animation-delay: 4s; }
    .poem-line:nth-child(4) { animation-delay: 6s; }

    /* çƒŸèŠ±ç”»å¸ƒ */
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    /* å€’è®¡æ—¶ç»“æŸåï¼Œä¸»å†…å®¹æ•´ä½“å±…ä¸­ï¼ˆåŒ…æ‹¬è›‹ç³•+ç¥ç¦ï¼‰ */
    body.dark-mode #main-content {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    body.dark-mode #countdown {
      display: none;
    }
  </style>
</head>
<body>
  <!-- çƒŸèŠ±èƒŒæ™¯ -->
  <canvas id="fireworks"></canvas>

  <!-- ä¸»å†…å®¹ï¼šå€’è®¡æ—¶ + è›‹ç³• + ç¥ç¦è¯­ -->
  <div id="main-content">
    <div id="countdown">5</div>
    <div id="cake-container">
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <g id="layer1" class="cake-part">
          <rect x="40" y="130" width="120" height="30" fill="#d2691e" rx="4" />
          <ellipse cx="100" cy="125" rx="65" ry="14" fill="#ff69b4" />
        </g>
        <g id="layer2" class="cake-part">
          <rect x="50" y="100" width="100" height="30" fill="#8b4513" rx="4" />
          <ellipse cx="100" cy="95" rx="55" ry="12" fill="#ff69b4" />
        </g>
        <g id="layer3" class="cake-part">
          <rect x="60" y="70" width="80" height="30" fill="#cd853f" rx="4" />
          <ellipse cx="100" cy="65" rx="45" ry="10" fill="#ff69b4" />
        </g>
        <g id="candle" class="cake-part">
          <rect x="95" y="50" width="4" height="15" fill="#ffa500" />
          <ellipse cx="97" cy="45" rx="6" ry="8" fill="#ff4500" />
          <ellipse cx="97" cy="45" rx="3" ry="5" fill="yellow" />
          <animate attributeName="fill" values="yellow;#ffcc00;yellow" dur="1s" repeatCount="indefinite" />
        </g>
      </svg>
    </div>
    <h2 id="wish">å°æ˜ï¼Œç¥ä½ ç”Ÿæ—¥å¿«ä¹ï¼</h2>
  </div>

  <!-- è¯—å¥ -->
  <div id="poem-container">
    <div class="poem-line">æ„¿ä½ å¦‚æ˜Ÿç’€ç’¨ï¼Œ</div>
    <div class="poem-line">å²å²å¸¸æ¬¢æ„‰ï¼Œ</div>
    <div class="poem-line">ä¸‡äº‹çš†èƒœæ„ï¼Œ</div>
    <div class="poem-line">ç”Ÿæ—¥å¿«ä¹ï¼</div>
  </div>

  <script>
    let count = 5;
    const countdownEl = document.getElementById("countdown");
    const cakeParts = [
      null,
      document.getElementById("layer1"),
      document.getElementById("layer2"),
      document.getElementById("layer3"),
      document.getElementById("candle")
    ];

    // å¯åŠ¨å€’è®¡æ—¶
    const countdownInterval = setInterval(() => {
      countdownEl.textContent = count;

      if (count === 5) cakeParts[1]?.classList.add("visible");
      else if (count === 4) cakeParts[2]?.classList.add("visible");
      else if (count === 3) cakeParts[3]?.classList.add("visible");
      else if (count === 2) cakeParts[4]?.classList.add("visible");

      count--;

      if (count < 0) {
        clearInterval(countdownInterval);
        document.body.classList.add("dark-mode"); // åˆ‡é»‘åº• + å±…ä¸­å¸ƒå±€
        startContinuousFireworks();
      }
    }, 1000);

    // ========== çƒŸèŠ±ç³»ç»Ÿ ==========
    const canvas = document.getElementById("fireworks");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    const fireworks = [];
    const particles = [];

    class Firework {
      constructor(x, y, targetX, targetY) {
        this.x = x;
        this.y = y;
        this.targetX = targetX;
        this.targetY = targetY;
        this.speed = 2 + Math.random() * 2;
        this.angle = Math.atan2(targetY - y, targetX - x);
        this.velocity = { x: Math.cos(this.angle) * this.speed, y: Math.sin(this.angle) * this.speed };
        this.trail = [];
        this.hue = Math.random() * 360;
      }
      update() {
        this.trail.push({ x: this.x, y: this.y });
        if (this.trail.length > 6) this.trail.shift();
        this.x += this.velocity.x;
        this.y += this.velocity.y;
      }
      draw() {
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - this.velocity.x, this.y - this.velocity.y);
        ctx.strokeStyle = `hsl(${this.hue}, 100%, 60%)`;
        ctx.lineWidth = 2;
        ctx.stroke();

        this.trail.forEach((point, idx) => {
          ctx.beginPath();
          ctx.arc(point.x, point.y, idx / 2, 0, Math.PI * 2);
          ctx.fillStyle = `hsla(${this.hue}, 100%, 60%, ${idx / this.trail.length})`;
          ctx.fill();
        });
      }
      hasReachedTarget() {
        const dx = this.targetX - this.x;
        const dy = this.targetY - this.y;
        return Math.sqrt(dx * dx + dy * dy) < 8;
      }
    }

    class Particle {
      constructor(x, y, hue) {
        this.x = x;
        this.y = y;
        this.hue = hue;
        this.radius = Math.random() * 2 + 0.5;
        this.velocity = { x: (Math.random() - 0.5) * 5, y: (Math.random() - 0.5) * 5 };
        this.alpha = 1;
        this.decay = Math.random() * 0.02 + 0.01;
      }
      update() {
        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.alpha -= this.decay;
      }
      draw() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
        ctx.fill();
        ctx.restore();
      }
    }

    function launchRandomFirework() {
      const x = Math.random() * canvas.width;
      const y = canvas.height;
      const targetX = Math.random() * canvas.width;
      const targetY = Math.random() * canvas.height * 0.6;
      fireworks.push(new Firework(x, y, targetX, targetY));
    }

    function startContinuousFireworks() {
      setInterval(() => {
        if (Math.random() > 0.3) launchRandomFirework();
      }, 800);

      const animate = () => {
        requestAnimationFrame(animate);
        ctx.fillStyle = "rgba(0, 0, 0, 0.12)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = fireworks.length - 1; i >= 0; i--) {
          fireworks[i].update();
          fireworks[i].draw();
          if (fireworks[i].hasReachedTarget()) {
            for (let j = 0; j < 80; j++) {
              particles.push(new Particle(fireworks[i].x, fireworks[i].y, fireworks[i].hue));
            }
            fireworks.splice(i, 1);
          }
        }

        for (let i = particles.length - 1; i >= 0; i--) {
          particles[i].update();
          particles[i].draw();
          if (particles[i].alpha <= 0) particles.splice(i, 1);
        }
      };

      animate();
    }
  </script>
</body>
</html>
